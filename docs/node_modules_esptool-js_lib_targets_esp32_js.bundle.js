"use strict";
(self["webpackChunkTactility_Web_Installer"] = self["webpackChunkTactility_Web_Installer"] || []).push([["node_modules_esptool-js_lib_targets_esp32_js"],{

/***/ "./node_modules/esptool-js/lib/targets/esp32.js":
/*!******************************************************!*\
  !*** ./node_modules/esptool-js/lib/targets/esp32.js ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ESP32ROM: () => (/* binding */ ESP32ROM)
/* harmony export */ });
/* harmony import */ var _rom_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./rom.js */ "./node_modules/esptool-js/lib/targets/rom.js");

class ESP32ROM extends _rom_js__WEBPACK_IMPORTED_MODULE_0__.ROM {
    constructor() {
        super(...arguments);
        this.CHIP_NAME = "ESP32";
        this.IMAGE_CHIP_ID = 0;
        this.EFUSE_RD_REG_BASE = 0x3ff5a000;
        this.DR_REG_SYSCON_BASE = 0x3ff66000;
        this.UART_CLKDIV_REG = 0x3ff40014;
        this.UART_CLKDIV_MASK = 0xfffff;
        this.UART_DATE_REG_ADDR = 0x60000078;
        this.XTAL_CLK_DIVIDER = 1;
        this.FLASH_SIZES = {
            "1MB": 0x00,
            "2MB": 0x10,
            "4MB": 0x20,
            "8MB": 0x30,
            "16MB": 0x40,
        };
        this.FLASH_WRITE_SIZE = 0x400;
        this.BOOTLOADER_FLASH_OFFSET = 0x1000;
        this.SPI_REG_BASE = 0x3ff42000;
        this.SPI_USR_OFFS = 0x1c;
        this.SPI_USR1_OFFS = 0x20;
        this.SPI_USR2_OFFS = 0x24;
        this.SPI_W0_OFFS = 0x80;
        this.SPI_MOSI_DLEN_OFFS = 0x28;
        this.SPI_MISO_DLEN_OFFS = 0x2c;
    }
    async readEfuse(loader, offset) {
        const addr = this.EFUSE_RD_REG_BASE + 4 * offset;
        loader.debug("Read efuse " + addr);
        return await loader.readReg(addr);
    }
    async getPkgVersion(loader) {
        const word3 = await this.readEfuse(loader, 3);
        let pkgVersion = (word3 >> 9) & 0x07;
        pkgVersion += ((word3 >> 2) & 0x1) << 3;
        return pkgVersion;
    }
    async getChipRevision(loader) {
        const word3 = await this.readEfuse(loader, 3);
        const word5 = await this.readEfuse(loader, 5);
        const apbCtlDate = await loader.readReg(this.DR_REG_SYSCON_BASE + 0x7c);
        const revBit0 = (word3 >> 15) & 0x1;
        const revBit1 = (word5 >> 20) & 0x1;
        const revBit2 = (apbCtlDate >> 31) & 0x1;
        if (revBit0 != 0) {
            if (revBit1 != 0) {
                if (revBit2 != 0) {
                    return 3;
                }
                else {
                    return 2;
                }
            }
            else {
                return 1;
            }
        }
        return 0;
    }
    async getChipDescription(loader) {
        const chipDesc = [
            "ESP32-D0WDQ6",
            "ESP32-D0WD",
            "ESP32-D2WD",
            "",
            "ESP32-U4WDH",
            "ESP32-PICO-D4",
            "ESP32-PICO-V3-02",
        ];
        let chipName = "";
        const pkgVersion = await this.getPkgVersion(loader);
        const chipRevision = await this.getChipRevision(loader);
        const rev3 = chipRevision == 3;
        const single_core = (await this.readEfuse(loader, 3)) & (1 << 0);
        if (single_core != 0) {
            chipDesc[0] = "ESP32-S0WDQ6";
            chipDesc[1] = "ESP32-S0WD";
        }
        if (rev3) {
            chipDesc[5] = "ESP32-PICO-V3";
        }
        if (pkgVersion >= 0 && pkgVersion <= 6) {
            chipName = chipDesc[pkgVersion];
        }
        else {
            chipName = "Unknown ESP32";
        }
        if (rev3 && (pkgVersion === 0 || pkgVersion === 1)) {
            chipName += "-V3";
        }
        return chipName + " (revision " + chipRevision + ")";
    }
    async getChipFeatures(loader) {
        const features = ["Wi-Fi"];
        const word3 = await this.readEfuse(loader, 3);
        const chipVerDisBt = word3 & (1 << 1);
        if (chipVerDisBt === 0) {
            features.push(" BT");
        }
        const chipVerDisAppCpu = word3 & (1 << 0);
        if (chipVerDisAppCpu !== 0) {
            features.push(" Single Core");
        }
        else {
            features.push(" Dual Core");
        }
        const chipCpuFreqRated = word3 & (1 << 13);
        if (chipCpuFreqRated !== 0) {
            const chipCpuFreqLow = word3 & (1 << 12);
            if (chipCpuFreqLow !== 0) {
                features.push(" 160MHz");
            }
            else {
                features.push(" 240MHz");
            }
        }
        const pkgVersion = await this.getPkgVersion(loader);
        if ([2, 4, 5, 6].indexOf(pkgVersion) !== -1) {
            features.push(" Embedded Flash");
        }
        if (pkgVersion === 6) {
            features.push(" Embedded PSRAM");
        }
        const word4 = await this.readEfuse(loader, 4);
        const adcVref = (word4 >> 8) & 0x1f;
        if (adcVref !== 0) {
            features.push(" VRef calibration in efuse");
        }
        const blk3PartRes = (word3 >> 14) & 0x1;
        if (blk3PartRes !== 0) {
            features.push(" BLK3 partially reserved");
        }
        const word6 = await this.readEfuse(loader, 6);
        const codingScheme = word6 & 0x3;
        const codingSchemeArr = ["None", "3/4", "Repeat (UNSUPPORTED)", "Invalid"];
        features.push(" Coding Scheme " + codingSchemeArr[codingScheme]);
        return features;
    }
    async getCrystalFreq(loader) {
        const uartDiv = (await loader.readReg(this.UART_CLKDIV_REG)) & this.UART_CLKDIV_MASK;
        const etsXtal = (loader.transport.baudrate * uartDiv) / 1000000 / this.XTAL_CLK_DIVIDER;
        let normXtal;
        if (etsXtal > 33) {
            normXtal = 40;
        }
        else {
            normXtal = 26;
        }
        if (Math.abs(normXtal - etsXtal) > 1) {
            loader.info("WARNING: Unsupported crystal in use");
        }
        return normXtal;
    }
    _d2h(d) {
        const h = (+d).toString(16);
        return h.length === 1 ? "0" + h : h;
    }
    async readMac(loader) {
        let mac0 = await this.readEfuse(loader, 1);
        mac0 = mac0 >>> 0;
        let mac1 = await this.readEfuse(loader, 2);
        mac1 = mac1 >>> 0;
        const mac = new Uint8Array(6);
        mac[0] = (mac1 >> 8) & 0xff;
        mac[1] = mac1 & 0xff;
        mac[2] = (mac0 >> 24) & 0xff;
        mac[3] = (mac0 >> 16) & 0xff;
        mac[4] = (mac0 >> 8) & 0xff;
        mac[5] = mac0 & 0xff;
        return (this._d2h(mac[0]) +
            ":" +
            this._d2h(mac[1]) +
            ":" +
            this._d2h(mac[2]) +
            ":" +
            this._d2h(mac[3]) +
            ":" +
            this._d2h(mac[4]) +
            ":" +
            this._d2h(mac[5]));
    }
}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZV9tb2R1bGVzX2VzcHRvb2wtanNfbGliX3RhcmdldHNfZXNwMzJfanMuYnVuZGxlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStCO0FBQ3hCLHVCQUF1Qix3Q0FBRztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9UYWN0aWxpdHkgV2ViIEluc3RhbGxlci8uL25vZGVfbW9kdWxlcy9lc3B0b29sLWpzL2xpYi90YXJnZXRzL2VzcDMyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJPTSB9IGZyb20gXCIuL3JvbS5qc1wiO1xuZXhwb3J0IGNsYXNzIEVTUDMyUk9NIGV4dGVuZHMgUk9NIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5DSElQX05BTUUgPSBcIkVTUDMyXCI7XG4gICAgICAgIHRoaXMuSU1BR0VfQ0hJUF9JRCA9IDA7XG4gICAgICAgIHRoaXMuRUZVU0VfUkRfUkVHX0JBU0UgPSAweDNmZjVhMDAwO1xuICAgICAgICB0aGlzLkRSX1JFR19TWVNDT05fQkFTRSA9IDB4M2ZmNjYwMDA7XG4gICAgICAgIHRoaXMuVUFSVF9DTEtESVZfUkVHID0gMHgzZmY0MDAxNDtcbiAgICAgICAgdGhpcy5VQVJUX0NMS0RJVl9NQVNLID0gMHhmZmZmZjtcbiAgICAgICAgdGhpcy5VQVJUX0RBVEVfUkVHX0FERFIgPSAweDYwMDAwMDc4O1xuICAgICAgICB0aGlzLlhUQUxfQ0xLX0RJVklERVIgPSAxO1xuICAgICAgICB0aGlzLkZMQVNIX1NJWkVTID0ge1xuICAgICAgICAgICAgXCIxTUJcIjogMHgwMCxcbiAgICAgICAgICAgIFwiMk1CXCI6IDB4MTAsXG4gICAgICAgICAgICBcIjRNQlwiOiAweDIwLFxuICAgICAgICAgICAgXCI4TUJcIjogMHgzMCxcbiAgICAgICAgICAgIFwiMTZNQlwiOiAweDQwLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLkZMQVNIX1dSSVRFX1NJWkUgPSAweDQwMDtcbiAgICAgICAgdGhpcy5CT09UTE9BREVSX0ZMQVNIX09GRlNFVCA9IDB4MTAwMDtcbiAgICAgICAgdGhpcy5TUElfUkVHX0JBU0UgPSAweDNmZjQyMDAwO1xuICAgICAgICB0aGlzLlNQSV9VU1JfT0ZGUyA9IDB4MWM7XG4gICAgICAgIHRoaXMuU1BJX1VTUjFfT0ZGUyA9IDB4MjA7XG4gICAgICAgIHRoaXMuU1BJX1VTUjJfT0ZGUyA9IDB4MjQ7XG4gICAgICAgIHRoaXMuU1BJX1cwX09GRlMgPSAweDgwO1xuICAgICAgICB0aGlzLlNQSV9NT1NJX0RMRU5fT0ZGUyA9IDB4Mjg7XG4gICAgICAgIHRoaXMuU1BJX01JU09fRExFTl9PRkZTID0gMHgyYztcbiAgICB9XG4gICAgYXN5bmMgcmVhZEVmdXNlKGxvYWRlciwgb2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IGFkZHIgPSB0aGlzLkVGVVNFX1JEX1JFR19CQVNFICsgNCAqIG9mZnNldDtcbiAgICAgICAgbG9hZGVyLmRlYnVnKFwiUmVhZCBlZnVzZSBcIiArIGFkZHIpO1xuICAgICAgICByZXR1cm4gYXdhaXQgbG9hZGVyLnJlYWRSZWcoYWRkcik7XG4gICAgfVxuICAgIGFzeW5jIGdldFBrZ1ZlcnNpb24obG9hZGVyKSB7XG4gICAgICAgIGNvbnN0IHdvcmQzID0gYXdhaXQgdGhpcy5yZWFkRWZ1c2UobG9hZGVyLCAzKTtcbiAgICAgICAgbGV0IHBrZ1ZlcnNpb24gPSAod29yZDMgPj4gOSkgJiAweDA3O1xuICAgICAgICBwa2dWZXJzaW9uICs9ICgod29yZDMgPj4gMikgJiAweDEpIDw8IDM7XG4gICAgICAgIHJldHVybiBwa2dWZXJzaW9uO1xuICAgIH1cbiAgICBhc3luYyBnZXRDaGlwUmV2aXNpb24obG9hZGVyKSB7XG4gICAgICAgIGNvbnN0IHdvcmQzID0gYXdhaXQgdGhpcy5yZWFkRWZ1c2UobG9hZGVyLCAzKTtcbiAgICAgICAgY29uc3Qgd29yZDUgPSBhd2FpdCB0aGlzLnJlYWRFZnVzZShsb2FkZXIsIDUpO1xuICAgICAgICBjb25zdCBhcGJDdGxEYXRlID0gYXdhaXQgbG9hZGVyLnJlYWRSZWcodGhpcy5EUl9SRUdfU1lTQ09OX0JBU0UgKyAweDdjKTtcbiAgICAgICAgY29uc3QgcmV2Qml0MCA9ICh3b3JkMyA+PiAxNSkgJiAweDE7XG4gICAgICAgIGNvbnN0IHJldkJpdDEgPSAod29yZDUgPj4gMjApICYgMHgxO1xuICAgICAgICBjb25zdCByZXZCaXQyID0gKGFwYkN0bERhdGUgPj4gMzEpICYgMHgxO1xuICAgICAgICBpZiAocmV2Qml0MCAhPSAwKSB7XG4gICAgICAgICAgICBpZiAocmV2Qml0MSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJldkJpdDIgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBhc3luYyBnZXRDaGlwRGVzY3JpcHRpb24obG9hZGVyKSB7XG4gICAgICAgIGNvbnN0IGNoaXBEZXNjID0gW1xuICAgICAgICAgICAgXCJFU1AzMi1EMFdEUTZcIixcbiAgICAgICAgICAgIFwiRVNQMzItRDBXRFwiLFxuICAgICAgICAgICAgXCJFU1AzMi1EMldEXCIsXG4gICAgICAgICAgICBcIlwiLFxuICAgICAgICAgICAgXCJFU1AzMi1VNFdESFwiLFxuICAgICAgICAgICAgXCJFU1AzMi1QSUNPLUQ0XCIsXG4gICAgICAgICAgICBcIkVTUDMyLVBJQ08tVjMtMDJcIixcbiAgICAgICAgXTtcbiAgICAgICAgbGV0IGNoaXBOYW1lID0gXCJcIjtcbiAgICAgICAgY29uc3QgcGtnVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0UGtnVmVyc2lvbihsb2FkZXIpO1xuICAgICAgICBjb25zdCBjaGlwUmV2aXNpb24gPSBhd2FpdCB0aGlzLmdldENoaXBSZXZpc2lvbihsb2FkZXIpO1xuICAgICAgICBjb25zdCByZXYzID0gY2hpcFJldmlzaW9uID09IDM7XG4gICAgICAgIGNvbnN0IHNpbmdsZV9jb3JlID0gKGF3YWl0IHRoaXMucmVhZEVmdXNlKGxvYWRlciwgMykpICYgKDEgPDwgMCk7XG4gICAgICAgIGlmIChzaW5nbGVfY29yZSAhPSAwKSB7XG4gICAgICAgICAgICBjaGlwRGVzY1swXSA9IFwiRVNQMzItUzBXRFE2XCI7XG4gICAgICAgICAgICBjaGlwRGVzY1sxXSA9IFwiRVNQMzItUzBXRFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXYzKSB7XG4gICAgICAgICAgICBjaGlwRGVzY1s1XSA9IFwiRVNQMzItUElDTy1WM1wiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwa2dWZXJzaW9uID49IDAgJiYgcGtnVmVyc2lvbiA8PSA2KSB7XG4gICAgICAgICAgICBjaGlwTmFtZSA9IGNoaXBEZXNjW3BrZ1ZlcnNpb25dO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2hpcE5hbWUgPSBcIlVua25vd24gRVNQMzJcIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmV2MyAmJiAocGtnVmVyc2lvbiA9PT0gMCB8fCBwa2dWZXJzaW9uID09PSAxKSkge1xuICAgICAgICAgICAgY2hpcE5hbWUgKz0gXCItVjNcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hpcE5hbWUgKyBcIiAocmV2aXNpb24gXCIgKyBjaGlwUmV2aXNpb24gKyBcIilcIjtcbiAgICB9XG4gICAgYXN5bmMgZ2V0Q2hpcEZlYXR1cmVzKGxvYWRlcikge1xuICAgICAgICBjb25zdCBmZWF0dXJlcyA9IFtcIldpLUZpXCJdO1xuICAgICAgICBjb25zdCB3b3JkMyA9IGF3YWl0IHRoaXMucmVhZEVmdXNlKGxvYWRlciwgMyk7XG4gICAgICAgIGNvbnN0IGNoaXBWZXJEaXNCdCA9IHdvcmQzICYgKDEgPDwgMSk7XG4gICAgICAgIGlmIChjaGlwVmVyRGlzQnQgPT09IDApIHtcbiAgICAgICAgICAgIGZlYXR1cmVzLnB1c2goXCIgQlRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpcFZlckRpc0FwcENwdSA9IHdvcmQzICYgKDEgPDwgMCk7XG4gICAgICAgIGlmIChjaGlwVmVyRGlzQXBwQ3B1ICE9PSAwKSB7XG4gICAgICAgICAgICBmZWF0dXJlcy5wdXNoKFwiIFNpbmdsZSBDb3JlXCIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZmVhdHVyZXMucHVzaChcIiBEdWFsIENvcmVcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpcENwdUZyZXFSYXRlZCA9IHdvcmQzICYgKDEgPDwgMTMpO1xuICAgICAgICBpZiAoY2hpcENwdUZyZXFSYXRlZCAhPT0gMCkge1xuICAgICAgICAgICAgY29uc3QgY2hpcENwdUZyZXFMb3cgPSB3b3JkMyAmICgxIDw8IDEyKTtcbiAgICAgICAgICAgIGlmIChjaGlwQ3B1RnJlcUxvdyAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGZlYXR1cmVzLnB1c2goXCIgMTYwTUh6XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZmVhdHVyZXMucHVzaChcIiAyNDBNSHpcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGtnVmVyc2lvbiA9IGF3YWl0IHRoaXMuZ2V0UGtnVmVyc2lvbihsb2FkZXIpO1xuICAgICAgICBpZiAoWzIsIDQsIDUsIDZdLmluZGV4T2YocGtnVmVyc2lvbikgIT09IC0xKSB7XG4gICAgICAgICAgICBmZWF0dXJlcy5wdXNoKFwiIEVtYmVkZGVkIEZsYXNoXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwa2dWZXJzaW9uID09PSA2KSB7XG4gICAgICAgICAgICBmZWF0dXJlcy5wdXNoKFwiIEVtYmVkZGVkIFBTUkFNXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdvcmQ0ID0gYXdhaXQgdGhpcy5yZWFkRWZ1c2UobG9hZGVyLCA0KTtcbiAgICAgICAgY29uc3QgYWRjVnJlZiA9ICh3b3JkNCA+PiA4KSAmIDB4MWY7XG4gICAgICAgIGlmIChhZGNWcmVmICE9PSAwKSB7XG4gICAgICAgICAgICBmZWF0dXJlcy5wdXNoKFwiIFZSZWYgY2FsaWJyYXRpb24gaW4gZWZ1c2VcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmxrM1BhcnRSZXMgPSAod29yZDMgPj4gMTQpICYgMHgxO1xuICAgICAgICBpZiAoYmxrM1BhcnRSZXMgIT09IDApIHtcbiAgICAgICAgICAgIGZlYXR1cmVzLnB1c2goXCIgQkxLMyBwYXJ0aWFsbHkgcmVzZXJ2ZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgd29yZDYgPSBhd2FpdCB0aGlzLnJlYWRFZnVzZShsb2FkZXIsIDYpO1xuICAgICAgICBjb25zdCBjb2RpbmdTY2hlbWUgPSB3b3JkNiAmIDB4MztcbiAgICAgICAgY29uc3QgY29kaW5nU2NoZW1lQXJyID0gW1wiTm9uZVwiLCBcIjMvNFwiLCBcIlJlcGVhdCAoVU5TVVBQT1JURUQpXCIsIFwiSW52YWxpZFwiXTtcbiAgICAgICAgZmVhdHVyZXMucHVzaChcIiBDb2RpbmcgU2NoZW1lIFwiICsgY29kaW5nU2NoZW1lQXJyW2NvZGluZ1NjaGVtZV0pO1xuICAgICAgICByZXR1cm4gZmVhdHVyZXM7XG4gICAgfVxuICAgIGFzeW5jIGdldENyeXN0YWxGcmVxKGxvYWRlcikge1xuICAgICAgICBjb25zdCB1YXJ0RGl2ID0gKGF3YWl0IGxvYWRlci5yZWFkUmVnKHRoaXMuVUFSVF9DTEtESVZfUkVHKSkgJiB0aGlzLlVBUlRfQ0xLRElWX01BU0s7XG4gICAgICAgIGNvbnN0IGV0c1h0YWwgPSAobG9hZGVyLnRyYW5zcG9ydC5iYXVkcmF0ZSAqIHVhcnREaXYpIC8gMTAwMDAwMCAvIHRoaXMuWFRBTF9DTEtfRElWSURFUjtcbiAgICAgICAgbGV0IG5vcm1YdGFsO1xuICAgICAgICBpZiAoZXRzWHRhbCA+IDMzKSB7XG4gICAgICAgICAgICBub3JtWHRhbCA9IDQwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm9ybVh0YWwgPSAyNjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoTWF0aC5hYnMobm9ybVh0YWwgLSBldHNYdGFsKSA+IDEpIHtcbiAgICAgICAgICAgIGxvYWRlci5pbmZvKFwiV0FSTklORzogVW5zdXBwb3J0ZWQgY3J5c3RhbCBpbiB1c2VcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vcm1YdGFsO1xuICAgIH1cbiAgICBfZDJoKGQpIHtcbiAgICAgICAgY29uc3QgaCA9ICgrZCkudG9TdHJpbmcoMTYpO1xuICAgICAgICByZXR1cm4gaC5sZW5ndGggPT09IDEgPyBcIjBcIiArIGggOiBoO1xuICAgIH1cbiAgICBhc3luYyByZWFkTWFjKGxvYWRlcikge1xuICAgICAgICBsZXQgbWFjMCA9IGF3YWl0IHRoaXMucmVhZEVmdXNlKGxvYWRlciwgMSk7XG4gICAgICAgIG1hYzAgPSBtYWMwID4+PiAwO1xuICAgICAgICBsZXQgbWFjMSA9IGF3YWl0IHRoaXMucmVhZEVmdXNlKGxvYWRlciwgMik7XG4gICAgICAgIG1hYzEgPSBtYWMxID4+PiAwO1xuICAgICAgICBjb25zdCBtYWMgPSBuZXcgVWludDhBcnJheSg2KTtcbiAgICAgICAgbWFjWzBdID0gKG1hYzEgPj4gOCkgJiAweGZmO1xuICAgICAgICBtYWNbMV0gPSBtYWMxICYgMHhmZjtcbiAgICAgICAgbWFjWzJdID0gKG1hYzAgPj4gMjQpICYgMHhmZjtcbiAgICAgICAgbWFjWzNdID0gKG1hYzAgPj4gMTYpICYgMHhmZjtcbiAgICAgICAgbWFjWzRdID0gKG1hYzAgPj4gOCkgJiAweGZmO1xuICAgICAgICBtYWNbNV0gPSBtYWMwICYgMHhmZjtcbiAgICAgICAgcmV0dXJuICh0aGlzLl9kMmgobWFjWzBdKSArXG4gICAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgICB0aGlzLl9kMmgobWFjWzFdKSArXG4gICAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgICB0aGlzLl9kMmgobWFjWzJdKSArXG4gICAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgICB0aGlzLl9kMmgobWFjWzNdKSArXG4gICAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgICB0aGlzLl9kMmgobWFjWzRdKSArXG4gICAgICAgICAgICBcIjpcIiArXG4gICAgICAgICAgICB0aGlzLl9kMmgobWFjWzVdKSk7XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9